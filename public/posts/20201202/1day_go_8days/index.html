
<!DOCTYPE html>
<html lang="ja">
    
    


    
<head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Cache-Control" content="public" />
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.89.4" />

    
    
    

<title>たった1日で基本が身に付く！ Go言語 超入門@8日目 • Small Changes</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="たった1日で基本が身に付く！ Go言語 超入門@8日目"/>
<meta name="twitter:description" content="たった1日で基本が身に付く！ Go言語 超入門：書籍案内｜技術評論社 今日も最終章の続きをやっていきます。 CHAPTER 8 Go言語の魅力を体験するプログラム 画"/>

<meta property="og:title" content="たった1日で基本が身に付く！ Go言語 超入門@8日目" />
<meta property="og:description" content="たった1日で基本が身に付く！ Go言語 超入門：書籍案内｜技術評論社 今日も最終章の続きをやっていきます。 CHAPTER 8 Go言語の魅力を体験するプログラム 画" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://snyt45.com/posts/20201202/1day_go_8days/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-02T21:33:03+09:00" />
<meta property="article:modified_time" content="2020-12-02T21:33:03+09:00" /><meta property="og:site_name" content="Title" />



    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">








<link rel="stylesheet" href="/scss/hyde-hyde.3081c4981fb69a2783dd36ecfdd0e6ba7a158d4cbfdd290ebce8f78ba0469fc6.css" integrity="sha256-MIHEmB&#43;2mieD3Tbs/dDmunoVjUy/3SkOvOj3i6BGn8Y=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">




<link rel="stylesheet" href="/scss/tocbot.5ef07cebc3c477b54270456f149ee02922479bb7555fd344b2c69f953b0e7e5e.css" integrity="sha256-XvB868PEd7VCcEVvFJ7gKSJHm7dVX9NEssaflTsOfl4=">



    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    

    
    
      
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FFNLJVXS4C"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-FFNLJVXS4C');
</script>

    
    
    
</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://snyt45.com/">Small Changes</a>
      </span>
      
        
        
        
        <div class="author-image">
          <img src="https://snyt45.com/img/prof-icon-01.jpg" alt="Author Image" class="img--circle img--headshot element--center">
        </div>
        
      
      
      <p class="site__description">
        
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Small Changes</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/posts/">
						<span>Posts</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/snyt45" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://github.com/snyt45" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
	
	
	
	
</section>

      </div>
    </div>
    
<div class="copyright">
  &copy; 2020 - 2021 snyt45
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> ❤️ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>たった1日で基本が身に付く！ Go言語 超入門@8日目</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> 2020/12/02
    
    
    
    
    
    <br/>
    <i class="fas fa-clock"></i> 4 min read
</div>


  </header>
  
  
  
    <div class="toc-wrapper">
      <input type="checkbox" id="tocToggle">
      <label for="tocToggle">Table of Content</label>
      
        <div class="toc" id="TableOfContents"></div>
      
    </div>
  
  
  <div class="post">
    <p><a href="https://gihyo.jp/book/2020/978-4-297-11617-0">たった1日で基本が身に付く！ Go言語 超入門：書籍案内｜技術評論社</a></p>
<p>今日も最終章の続きをやっていきます。</p>
<h2 id="chapter-8go言語の魅力を体験するプログラム">CHAPTER 8　Go言語の魅力を体験するプログラム</h2>
<h3 id="画像を処理する">画像を処理する</h3>
<ul>
<li>Go言語には、画像を読み込んで分析したり、画像を作成して書き出すライブラリなどもある。</li>
</ul>
<h3 id="画像の読み込み">画像の読み込み</h3>
<ul>
<li>AI技術を活用した画像分析が盛ん。Go言語でもライブラリが用意されている。</li>
<li>簡単な画像分析プログラムとして、グレースケールの画像を読み込み、アスキーアートを作成する。</li>
</ul>
<p>①ファイルからPNG画像を読み込む
②PNGフォーマットをデコードして情報を取り出す
③画素1つ１つについて、グレー情報を数値(0なら黒、255なら白)で取得する
④グレー情報の数値を3段階に分けて、各画素を文字「*」「+」「-」のいずれかに変換する</p>
<pre tabindex="0"><code>package main

import (
	&quot;fmt&quot;
	&quot;image&quot;
	&quot;image/color&quot;
	_ &quot;image/png&quot;
	&quot;io/ioutil&quot;
	&quot;os&quot;
)

func main() {
	reader, ferr := os.Open(&quot;wow.png&quot;)
	if ferr != nil {
		fmt.Println(&quot;ファイルの読み込みエラーです&quot;, ferr)
		os.Exit(1)
	}

	img, name, derr := image.Decode(reader)
	if derr != nil {
		fmt.Println(&quot;画像の変換エラーです&quot;, derr)
		os.Exit(1)
	} else {
		fmt.Println(name, &quot;形式のデータを得ました&quot;)
	}

	defer reader.Close()

	marks := []string{&quot;*&quot;, &quot;+&quot;, &quot;-&quot;}
	var marksStr string

	for y := img.Bounds().Min.Y; y &lt; img.Bounds().Max.Y; y++ {
		for x := img.Bounds().Min.X; x &lt; img.Bounds().Max.X; x++ {
			c := color.GrayModel.Convert(img.At(x, y)).(color.Gray)
			grayness := c.Y / (255 / 3)
			if c.Y == 255 {
				grayness = 2
			}
			marksStr += marks[grayness]
		}
		marksStr += &quot;\n&quot;
	}
	wdata := []byte(marksStr)
	werr := ioutil.WriteFile(&quot;ascii_art.txt&quot;, wdata, 0777)
	if werr != nil {
		fmt.Println(&quot;ファイルの書き込みエラーです&quot;, werr)
		os.Exit(1)
	} else {
		fmt.Println(&quot;ファイルを保存しました&quot;)
	}
}
</code></pre><ul>
<li>importのアンダースコア
<ul>
<li><a href="https://hogesuke.hateblo.jp/entry/2014/09/12/080005">Go言語にて依存関係を解決するためのimportにはアンダースコア（ブランク識別子）を別名とする - 無理しない感じ</a></li>
<li>go言語ではパッケージをimportしたら、プログラム中で使わないとコンパイルエラーになる</li>
<li>例えば、プログラム中では使わないがAパッケージが依存するBパッケージを読み込みたいとき（依存関係を解決したいとき）にブランク識別子(_)を使うようだ</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>	_ &quot;image/png&quot;
</code></pre><ul>
<li>画像ファイルの読み込みには、os.Open関数を使う
<ul>
<li>一つ目の戻り値はファイルの内容で、io.Readerという型をもつ</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>	reader, ferr := os.Open(&quot;wow.png&quot;)
</code></pre><ul>
<li>次にファイルのデコードには、image.Decodeを使う
<ul>
<li>一つ目の戻り値はデコードした画像で、image.imageという型をもつ</li>
<li>二つ目の戻り値はファイルの形式を示す文字列（ここではpng）</li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>	img, name, derr := image.Decode(reader)
</code></pre><ul>
<li><code>reader.Close()</code>でファイルを閉じるだが、その前に<code>defer</code>がついている。</li>
<li><code>defer</code>は遅延関数</li>
<li>deferを呼び出した関数が終了する際に実行される
<ul>
<li><a href="http://y0m0r.hateblo.jp/entry/20130925/1380117667">Go言語のdeferでファイルリソースをクローズする - 雑多なメモ置き場</a></li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>defer reader.Close() // 関数の最後にファイルを閉じる
</code></pre><ul>
<li>メインのロジックは説明が少なくいまは難しい
<ul>
<li>そのうち公式リファレンスを見て理解できるようになりたい。</li>
<li><a href="https://golang.org/pkg/io/#Reader">io - The Go Programming Language</a></li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>	for y := img.Bounds().Min.Y; y &lt; img.Bounds().Max.Y; y++ {
		for x := img.Bounds().Min.X; x &lt; img.Bounds().Max.X; x++ {
			c := color.GrayModel.Convert(img.At(x, y)).(color.Gray)
			grayness := c.Y / (255 / 3)
			if c.Y == 255 {
				grayness = 2
			}
			marksStr += marks[grayness]
		}
		marksStr += &quot;\n&quot;
</code></pre><ul>
<li>作成されたアスキーアート！なんか色々できそうですごい！</li>
</ul>
<p><img src="asciiart.png" alt="アスキーアート"></p>
<h3 id="画像の作成と書き込み">画像の作成と書き込み</h3>
<pre tabindex="0"><code>package main

import (
	&quot;fmt&quot;
	&quot;image&quot;
	&quot;image/color&quot;
	&quot;image/png&quot;
	&quot;os&quot;
)

func inrange(x, a, b int) bool {
	if a &lt; b &amp;&amp; a &lt;= x &amp;&amp; x &lt; b {
		return true
	}
	return false
}

func main() {

	const width = 350
	const height = 350
	const celllen = 50

	img := image.NewNRGBA(image.Rect(0, 0, width, height))

	cells := [7][7]int{
		{0, 1, 0, 1, 0, 1, 0},
		{0, 1, 1, 1, 1, 1, 0},
		{0, 1, 1, 1, 1, 1, 0},
		{0, 0, 1, 1, 1, 0, 0},
		{0, 0, 0, 2, 0, 0, 0},
		{0, 2, 0, 2, 0, 2, 0},
		{0, 0, 2, 2, 2, 0, 0},
	}
	colors := [3]color.RGBA{
		color.RGBA{0xff, 0xff, 0xff, 0xff},
		color.RGBA{0xff, 0, 0, 0xff},
		color.RGBA{0, 0xff, 0, 0xff},
	}

	for y := 0; y &lt; height; y++ {
		for x := 0; x &lt; width; x++ {
			for ny := 0; ny &lt; 7; ny++ {
				for nx := 0; nx &lt; 7; nx++ {
					if inrange(x, nx * celllen, (nx + 1) * celllen) &amp;&amp;
					  inrange(y, ny * celllen, (ny + 1) * celllen) {
							img.Set(x, y, colors[cells[ny][nx]])
						}
				}
			}
		}
	}

	f, ferr := os.Create(&quot;flower.png&quot;)
	if ferr != nil {
		fmt.Println(&quot;ファイル作成のエラー：&quot;, ferr)
		os.Exit(1)
	}

	derr := png.Encode(f, img)

	if derr != nil {
		f.Close()
		fmt.Println(&quot;データ変換のエラー：&quot;, derr)
		os.Exit(1)
	}

	ferr = f.Close()
	if ferr != nil {
		fmt.Println(&quot;ファイル作成のエラー：&quot;, ferr)
		os.Exit(1)
	}
}
</code></pre><ul>
<li>これもコード的な解説が少ないので、調べながら。</li>
<li><code>image.Rect(0, 0, width, height)</code>で350x350の画像作成</li>
<li><code>image.NewNRGBA</code>でNRGBA構造体のポインタが返る
<ul>
<li><a href="https://ja.stackoverflow.com/questions/22413/golang-image%E3%83%91%E3%83%83%E3%82%B1%E3%83%BC%E3%82%B8%E3%81%AErgba%E7%AD%89%E3%81%A8nrgba%E7%AD%89%E3%81%AE%E9%81%95%E3%81%84">go - Golang imageパッケージのRGBA等とNRGBA等の違い - スタック・オーバーフロー</a></li>
</ul>
</li>
</ul>
<pre tabindex="0"><code>	img := image.NewNRGBA(image.Rect(0, 0, width, height)
</code></pre><ul>
<li>ここで書き込んでいるらしい</li>
</ul>
<pre tabindex="0"><code>	derr := png.Encode(f, img)
</code></pre><ul>
<li>書き出される画像</li>
</ul>
<p><img src="flower.png" alt="花の画像"></p>
<h2 id="今日の学び">今日の学び</h2>
<ul>
<li>画像をライブラリで扱えるのはすごい！ただ、やっていることが高度すぎて今の時点で理解するのは難しそう。。。</li>
<li>あと、ライブラリを使うと一気にやっていることがブラックボックスに包まれるのでもっと数をこなしてライブラリのコードとかリファレンスを追えるようになりたい。</li>
</ul>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/20201201/1day_go_7days/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">たった1日で基本が身に付く！ Go言語 超入門@7日目</span>
    </a>
    
    
    <a href="/posts/20201203/1day_go_9days/" class="navigation-next">
      <span class="navigation-tittle">たった1日で基本が身に付く！ Go言語 超入門@9日目</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  

  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.11.2/js/all.js" integrity="sha384-b3ua1l97aVGAPEIe48b4TC60WUQbQaGi2jqAWM90y0OZXZeyaTCWtBTKtjW2GXG1" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



<script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.js"></script>
<script type="text/javascript">
  if (tocbot) {
    tocbot.init({
      
      tocSelector: '.toc',
      
      contentSelector: '.post',
      
      headingSelector: 'h2, h3, h4',
      collapseDepth: 4
    });
  }
</script>



    



        
        
    </body>
</html>
